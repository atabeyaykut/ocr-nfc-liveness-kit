// React Native Android app module build configuration (RN 0.74+ compatible)
// This file defines debug and release buildTypes and a sample signingConfig

plugins {
  id 'com.android.application'
  id 'com.facebook.react'
}

android {
  namespace "com.ocrmobilesdk"
  compileSdkVersion 34

  defaultConfig {
    applicationId "com.ocrmobilesdk"
    minSdkVersion rootProject.ext.minSdkVersion
    targetSdkVersion 34
    versionCode 1
    versionName "1.0.0"
    multiDexEnabled true
  }

  compileOptions {
    sourceCompatibility JavaVersion.VERSION_17
    targetCompatibility JavaVersion.VERSION_17
  }

  def keystorePropertiesFile = rootProject.file("keystore.properties")
  def keystoreProperties = new Properties()
  if (keystorePropertiesFile.exists()) {
      keystoreProperties.load(new FileInputStream(keystorePropertiesFile))
  }

  signingConfigs {
    debug {
      // Debug keystore is automatically provided by the Android SDK
    }
    release {
        def storeFilePath = keystoreProperties['STORE_FILE'] ?: 'ocr-release-key.keystore'
        storeFile rootProject.file(storeFilePath)
        storePassword keystoreProperties['STORE_PASSWORD'] ?: System.getenv("RELEASE_STORE_PASSWORD")
        keyAlias keystoreProperties['KEY_ALIAS'] ?: 'ocr-key-alias'
        keyPassword keystoreProperties['KEY_PASSWORD'] ?: System.getenv("RELEASE_KEY_PASSWORD")
    }
  }

  buildTypes {
    debug {
      applicationIdSuffix ".debug"
      versionNameSuffix "-debug"
      debuggable true
      signingConfig signingConfigs.debug
    }
    release {
        signingConfig signingConfigs.release
        minifyEnabled true
        shrinkResources true
        proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
    }
  }

  // Generate separate APKs per CPU architecture (optional)
  splits {
    abi {
      enable true
      reset()
      include 'armeabi-v7a', 'arm64-v8a', 'x86', 'x86_64'
      universalApk true
    }
  }

  packagingOptions {
    resources {
      excludes += [
        'META-INF/LICENSE*',
        'META-INF/DEPENDENCIES',
        'META-INF/NOTICE*'
      ]
    }
  }
}



dependencies {
  implementation("com.facebook.react:react-android")

  // Add AndroidX AppCompat (commonly needed by RN libs)
  implementation "androidx.appcompat:appcompat:1.6.1"
  implementation "com.google.android.material:material:1.10.0"
  
  // Multidex support for large applications
  implementation "androidx.multidex:multidex:2.0.1"
  
  // BouncyCastle for cryptography (NFC signature validation)
  implementation "org.bouncycastle:bcprov-jdk15on:1.70"
  implementation "org.bouncycastle:bcpkix-jdk15on:1.70"

  // NFC (if used natively)
  // implementation "com.google.android.gms:play-services-nfc:18.1.0"
  
  // Test dependencies
  testImplementation "junit:junit:4.13.2"
  testImplementation "org.mockito:mockito-core:4.11.0"
  testImplementation "org.robolectric:robolectric:4.10.3"
  testImplementation "androidx.test:core:1.5.0"
  testImplementation "androidx.test.ext:junit:1.1.5"
}
